<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrito â€” TiendaOnline</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="page-wrapper">

  <!-- â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="navbar" role="navigation" aria-label="NavegaciÃ³n principal">
    <div class="navbar-inner">
      <a href="index.html" class="navbar-brand">Tienda<span>Online</span></a>
      <div class="navbar-actions">
        <a href="index.html" class="btn btn-secondary btn-sm">Seguir comprando</a>
        <button class="nav-cart-btn" aria-label="Ver carrito" aria-current="page">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          Carrito
          <span class="cart-count" id="cart-count">0</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main>
    <div class="container">

      <div class="section-header">
        <h1 class="section-title">Tu Carrito</h1>
        <button class="btn btn-secondary btn-sm" id="btn-clear-cart" aria-label="Vaciar carrito completo">Vaciar carrito</button>
      </div>

      <!-- Layout carrito + resumen -->
      <div class="cart-layout">

        <!-- Lista de items -->
        <div>
          <div id="cart-items-container">
            <!-- items renderizados por JS -->
          </div>
        </div>

        <!-- Resumen del pedido -->
        <aside class="cart-summary" aria-label="Resumen del pedido">
          <h2 style="font-size:1rem; font-weight:700; margin-bottom:1rem;">Resumen del pedido</h2>

          <div class="summary-row">
            <span>Subtotal</span>
            <span id="summary-subtotal">$0</span>
          </div>
          <div class="summary-row">
            <span>Ahorro total</span>
            <span id="summary-savings" style="color:var(--success);">$0</span>
          </div>
          <div class="summary-row">
            <span>EnvÃ­o</span>
            <span style="color:var(--success); font-weight:600;">GRATIS</span>
          </div>
          <div class="summary-row summary-total">
            <span>Total</span>
            <span id="summary-total">$0</span>
          </div>

          <button
            class="btn btn-primary btn-full"
            id="btn-checkout"
            style="margin-top:1.25rem;"
            aria-label="Proceder al checkout"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" aria-hidden="true"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            Proceder al checkout
          </button>

          <a href="index.html" style="display:block; text-align:center; margin-top:.75rem; font-size:.82rem; color:var(--text-muted);">
            o seguir comprando
          </a>
        </aside>

      </div>
    </div>
  </main>

  <!-- â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer>
    <p>&copy; <span id="year"></span> TiendaOnline. Todos los derechos reservados.</p>
  </footer>

</div>

<!-- Toast container -->
<div class="toast-container" id="toast-container" aria-live="polite" aria-atomic="true"></div>

<!-- â”€â”€ Scripts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script type="module">
// â”€â”€ Estado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let cart = [];

// â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const cartItemsContainer = document.getElementById("cart-items-container");
const cartCountEl        = document.getElementById("cart-count");
const summarySubtotal    = document.getElementById("summary-subtotal");
const summarySavings     = document.getElementById("summary-savings");
const summaryTotal       = document.getElementById("summary-total");
const btnCheckout        = document.getElementById("btn-checkout");
const btnClear           = document.getElementById("btn-clear-cart");

document.getElementById("year").textContent = new Date().getFullYear();

// â”€â”€ localStorage helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getCart() {
  try { return JSON.parse(localStorage.getItem("cart")) || []; }
  catch { return []; }
}

function saveCart(data) {
  localStorage.setItem("cart", JSON.stringify(data));
}

// â”€â”€ Formatear nÃºmero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function formatPrice(n) {
  return "$" + Number(n).toLocaleString("es", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

// â”€â”€ Render completo del carrito â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCart() {
  cart = getCart();
  updateCartCount();

  if (cart.length === 0) {
    cartItemsContainer.innerHTML = `
      <div class="empty-state" role="status">
        <div class="empty-state-icon" aria-hidden="true">ðŸ›’</div>
        <h3>Tu carrito estÃ¡ vacÃ­o</h3>
        <p>Agrega productos para continuar.</p>
        <a href="index.html" class="btn btn-primary" style="margin-top:1rem;">Explorar productos</a>
      </div>`;
    updateSummary(0, 0);
    btnCheckout.disabled = true;
    return;
  }

  btnCheckout.disabled = false;

  // Calcular totales
  let subtotal = 0;
  let savings  = 0;

  cart.forEach(item => {
    subtotal += item.price * item.quantity;
    // Si el item tiene precio original, calcular ahorro
    if (item.originalPrice) {
      savings += (item.originalPrice - item.price) * item.quantity;
    }
  });

  cartItemsContainer.innerHTML = cart.map(itemHTML).join("");
  updateSummary(subtotal, savings);
  attachItemEvents();
}

// â”€â”€ HTML de cada item â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function itemHTML(item) {
  const imgSrc = item.image || "https://placehold.co/80x80?text=Producto";
  return `
    <div class="cart-item" data-id="${item.id}">
      <img
        class="cart-item-img"
        src="${imgSrc}"
        alt="${item.name}"
        onerror="this.src='https://placehold.co/80x80?text=Sin+imagen'"
      />
      <div class="cart-item-info">
        <p class="cart-item-name">${item.name}</p>
        <p class="cart-item-meta">Precio unitario: ${formatPrice(item.price)}</p>
        <div class="quantity-control">
          <button class="qty-btn" data-action="minus" data-id="${item.id}" aria-label="Disminuir cantidad de ${item.name}">-</button>
          <span class="qty-value">${item.quantity}</span>
          <button class="qty-btn" data-action="plus"  data-id="${item.id}" aria-label="Aumentar cantidad de ${item.name}">+</button>
          <button class="btn btn-danger btn-sm" style="margin-left:.5rem;" data-action="remove" data-id="${item.id}" aria-label="Eliminar ${item.name} del carrito">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/></svg>
          </button>
        </div>
      </div>
      <div class="cart-item-price">${formatPrice(item.price * item.quantity)}</div>
    </div>`;
}

// â”€â”€ Eventos de botones en items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function attachItemEvents() {
  cartItemsContainer.querySelectorAll("[data-action]").forEach(btn => {
    btn.addEventListener("click", () => {
      const action = btn.dataset.action;
      const id     = btn.dataset.id;
      handleItemAction(action, id);
    });
  });
}

// â”€â”€ Acciones sobre items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleItemAction(action, id) {
  const idx = cart.findIndex(i => i.id === id);
  if (idx === -1) return;

  if (action === "minus") {
    if (cart[idx].quantity > 1) {
      cart[idx].quantity--;
    } else {
      cart.splice(idx, 1);
    }
  } else if (action === "plus") {
    if (cart[idx].quantity < cart[idx].stock) {
      cart[idx].quantity++;
    } else {
      showToast("Stock mÃ¡ximo alcanzado", "warning");
      return;
    }
  } else if (action === "remove") {
    cart.splice(idx, 1);
    showToast("Producto eliminado del carrito", "info");
  }

  saveCart(cart);
  renderCart();
}

// â”€â”€ Actualizar resumen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateSummary(subtotal, savings) {
  summarySubtotal.textContent = formatPrice(subtotal);
  summarySavings.textContent  = savings > 0 ? "-" + formatPrice(savings) : "$0";
  summaryTotal.textContent    = formatPrice(subtotal);
}

// â”€â”€ Actualizar badge carrito â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateCartCount() {
  const total = cart.reduce((acc, i) => acc + i.quantity, 0);
  cartCountEl.textContent = total;
}

// â”€â”€ Vaciar carrito â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnClear.addEventListener("click", () => {
  if (cart.length === 0) return;
  if (confirm("Â¿Vaciar todo el carrito?")) {
    saveCart([]);
    cart = [];
    renderCart();
    showToast("Carrito vaciado", "info");
  }
});

// â”€â”€ Ir a checkout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnCheckout.addEventListener("click", () => {
  if (cart.length === 0) {
    showToast("Tu carrito estÃ¡ vacÃ­o", "error");
    return;
  }
  window.location.href = "checkout.html";
});

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(message, type = "info") {
  const container = document.getElementById("toast-container");
  const toast     = document.createElement("div");
  toast.className = `toast toast-${type}`;
  toast.setAttribute("role", "alert");
  toast.textContent = message;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3200);
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderCart();
</script>
</body>
</html>
